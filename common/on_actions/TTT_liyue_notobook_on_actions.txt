on_actions = {
	on_startup = {
		effect = {
			LYU = {
				set_variable = { global.current_selected_program = 1 }
				set_variable = { global.lyu_monthly_pp_base = 1 }	# monthly program progress is 1%
				set_variable = { global.liyue_notebook_ui_dirty = 0 }
				add_to_array = { global.lyu_projects_array = 2 }
				add_to_array = { global.lyu_projects_array = 3 }
				add_to_array = { global.lyu_projects_array = 1 }
				#resize_array = {
				#	array = global.lyu_projects_array
				#	size = 30
				#	value = 1
				#}
				resize_array = {
					array = global.lyu_proj_arr
					size = 10
					value = 0
				}
				resize_array = {
					array = global.lyu_proj_arr_1
					size = 10
					value = 0
				}
				resize_array = {
					array = global.lyu_proj_arr_2
					size = 10
					value = 0
				}
				resize_array = {
					array = global.lyu_proj_arr_3
					size = 10
					value = 0
				}
				resize_array = {
					array = global.lyu_proj_arr_4
					size = 10
					value = 0
				}
				resize_array = {
					array = global.lyu_proj_arr_5
					size = 10
					value = 0
				}
				#log = "[?global.lyu_projects_array^0] is first value in array"
				#add_to_array = { global.lyu_proj_arr^0 = 100 }
				#log = "[?global.lyu_proj_arr^0^0] is the first value in 2 dimension array."
			}
		}
	}
	
	on_monthly = {
		effect = {
			if = {
				limit = { 
					OR = {
						has_global_flag = ttt_liyue_civil_war_end
						AND = {
							NOT = { has_global_flag = Liyue_Civil_War_Coming }
							NOT = {	has_global_flag = Liyue_Civil_War }
						}
					}
					OR = {
						NOT = { has_global_flag = liyue_progress_cd }
						has_global_flag = {
							flag = liyue_progress_cd
							days > 28
						}
					}
				}
				#log = "Liyue on monthly code started!"
				clr_global_flag = liyue_progress_cd
				set_global_flag = liyue_progress_cd
				
				for_each_loop = {
					array = global.lyu_proj_arr
					index = v
					
					set_variable = { global.lyu_proj_arr_5^v = 0 }	#refresh monthly progress
					if = {
						limit = { check_variable = { global.lyu_proj_arr_1^v = 1 } }	#only 1 makes sense
						
						#global.lyu_proj_arr_5^v calculating
						add_to_variable = {	global.lyu_proj_arr_5^v = global.lyu_monthly_pp_base }
						set_temp_variable = { extra_progress = global.lyu_proj_arr_4^v }
						#Lv1 resource --> 0.2% monthly progress
						divide_temp_variable = { extra_progress = 5 }
						add_to_variable = {	global.lyu_proj_arr_5^v = extra_progress }
						
						#global.lyu_proj_arr_2^v calculating
						add_to_variable = {
							global.lyu_proj_arr_2^v = global.lyu_proj_arr_5^v
						}
						
						if = {
							limit = { check_variable = { global.lyu_proj_arr_2^v > 100 } }
							set_variable = { global.lyu_proj_arr_2^v = 100 }
							set_variable = { global.lyu_proj_arr_1^v = 2 }	#building --> finished
						}
					}
				}
				#finally, refresh ui
				add_to_variable = { global.liyue_notebook_ui_dirty = 1 }
			}
			#log = "Liyue on monthly code finished yet!"
		}
	}
}